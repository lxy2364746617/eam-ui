{"version":3,"file":"index.js","sources":["../lib/EditorActions.js","../lib/Linting.js","../lib/index.js"],"sourcesContent":["export default function EditorActions(injector, linting) {\n  var editorActions = injector.get('editorActions', false);\n\n  editorActions && editorActions.register({\n    toggleLinting: function() {\n      linting.toggle();\n    }\n  });\n}\n\nEditorActions.$inject = [\n  'injector',\n  'linting'\n];","import { Linter } from 'bpmnlint';\r\n\r\nimport {\r\n  assign,\r\n  groupBy,\r\n  reduce\r\n} from 'min-dash';\r\n\r\nimport {\r\n  domify\r\n} from 'min-dom';\r\n\r\nimport {\r\n  escapeHTML\r\n} from 'diagram-js/lib/util/EscapeUtil';\r\n\r\nimport ErrorSvg from '../assets/svg/error.svg';\r\nimport WarningSvg from '../assets/svg/warning.svg';\r\nimport SuccessSvg from '../assets/svg/success.svg';\r\n\r\nvar OFFSET_TOP = -7,\r\n    OFFSET_RIGHT = -7;\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\nvar emptyConfig = {\r\n  resolver: {\r\n    resolveRule: function() {\r\n      return null;\r\n    }\r\n  },\r\n  config: {}\r\n};\r\n\r\nvar stateToIcon = {\r\n  error: ErrorSvg,\r\n  warning: WarningSvg,\r\n  success: SuccessSvg,\r\n  inactive: SuccessSvg\r\n};\r\n\r\nexport default function Linting(\r\n    bpmnjs,\r\n    canvas,\r\n    config,\r\n    elementRegistry,\r\n    eventBus,\r\n    overlays,\r\n    translate\r\n) {\r\n  this._bpmnjs = bpmnjs;\r\n  this._canvas = canvas;\r\n  this._elementRegistry = elementRegistry;\r\n  this._eventBus = eventBus;\r\n  this._overlays = overlays;\r\n  this._translate = translate;\r\n\r\n  this._issues = {};\r\n\r\n  this._active = config && config.active || false;\r\n  this._linterConfig = emptyConfig;\r\n\r\n  this._overlayIds = {};\r\n\r\n  var self = this;\r\n\r\n  eventBus.on([\r\n    'import.done',\r\n    'elements.changed',\r\n    'linting.configChanged',\r\n    'linting.toggle'\r\n  ], LOW_PRIORITY, function(e) {\r\n    if (self.isActive()) {\r\n      self.update();\r\n    }\r\n  });\r\n\r\n  eventBus.on('linting.toggle', function(event) {\r\n\r\n    const active = event.active;\r\n\r\n    if (!active) {\r\n      self._clearIssues();\r\n      self._updateButton();\r\n    }\r\n  });\r\n\r\n  eventBus.on('diagram.clear', function() {\r\n    self._clearIssues();\r\n  });\r\n\r\n  var linterConfig = config && config.bpmnlint;\r\n\r\n  linterConfig && eventBus.once('diagram.init', function() {\r\n\r\n    // bail out if config was already provided\r\n    // during initialization of other modules\r\n    if (self.getLinterConfig() !== emptyConfig) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      self.setLinterConfig(linterConfig);\r\n    } catch (err) {\r\n      console.error(\r\n        '[bpmn-js-bpmnlint] Invalid lint rules configured. ' +\r\n        'Please doublecheck your linting.bpmnlint configuration, ' +\r\n        'cf. https://github.com/bpmn-io/bpmn-js-bpmnlint#configure-lint-rules'\r\n      );\r\n    }\r\n  });\r\n\r\n  this._init();\r\n}\r\n\r\nLinting.prototype.setLinterConfig = function(linterConfig) {\r\n\r\n  if (!linterConfig.config || !linterConfig.resolver) {\r\n    throw new Error('Expected linterConfig = { config, resolver }');\r\n  }\r\n\r\n  this._linterConfig = linterConfig;\r\n\r\n  this._eventBus.fire('linting.configChanged');\r\n};\r\n\r\nLinting.prototype.getLinterConfig = function() {\r\n  return this._linterConfig;\r\n};\r\n\r\nLinting.prototype._init = function() {\r\n  this._createButton();\r\n\r\n  this._updateButton();\r\n};\r\n\r\nLinting.prototype.isActive = function() {\r\n  return this._active;\r\n};\r\n\r\nLinting.prototype._formatIssues = function(issues) {\r\n\r\n  const reports = reduce(issues, function(reports, ruleReports, rule) {\r\n\r\n    return reports.concat(ruleReports.map(function(report) {\r\n      report.rule = rule;\r\n\r\n      return report;\r\n    }));\r\n\r\n  }, []);\r\n\r\n  return groupBy(reports, function(report) {\r\n    return report.id;\r\n  });\r\n};\r\n\r\n/**\r\n * Toggle linting on or off.\r\n *\r\n * @param {boolean} [newActive]\r\n *\r\n * @return {boolean} the new active state\r\n */\r\nLinting.prototype.toggle = function(newActive) {\r\n\r\n  newActive = typeof newActive === 'undefined' ? !this.isActive() : newActive;\r\n\r\n  this._setActive(newActive);\r\n\r\n  return newActive;\r\n};\r\n\r\nLinting.prototype._setActive = function(active) {\r\n\r\n  if (this._active === active) {\r\n    return;\r\n  }\r\n\r\n  this._active = active;\r\n\r\n  this._eventBus.fire('linting.toggle', { active: active });\r\n};\r\n\r\n/**\r\n * Update overlays. Always lint and check wether overlays need update or not.\r\n */\r\nLinting.prototype.update = function() {\r\n  var self = this;\r\n\r\n  var definitions = this._bpmnjs.getDefinitions();\r\n\r\n  if (!definitions) {\r\n    return;\r\n  }\r\n\r\n  var lintStart = this._lintStart = Math.random();\r\n\r\n  this.lint().then(function(newIssues) {\r\n\r\n    if (self._lintStart !== lintStart) {\r\n      return;\r\n    }\r\n\r\n    newIssues = self._formatIssues(newIssues);\r\n\r\n    var remove = {},\r\n        update = {},\r\n        add = {};\r\n\r\n    for (var id1 in self._issues) {\r\n      if (!newIssues[id1]) {\r\n        remove[id1] = self._issues[id1];\r\n      }\r\n    }\r\n\r\n    for (var id2 in newIssues) {\r\n      if (!self._issues[id2]) {\r\n        add[id2] = newIssues[id2];\r\n      } else {\r\n        if (newIssues[id2] !== self._issues[id2]) {\r\n          update[id2] = newIssues[id2];\r\n        }\r\n      }\r\n    }\r\n\r\n    remove = assign(remove, update);\r\n    add = assign(add, update);\r\n\r\n    self._clearOverlays();\r\n    self._createIssues(add);\r\n\r\n    self._issues = newIssues;\r\n\r\n    self._updateButton();\r\n\r\n    self._fireComplete(newIssues);\r\n  });\r\n};\r\n\r\nLinting.prototype._fireComplete = function(issues) {\r\n  this._eventBus.fire('linting.completed', { issues: issues });\r\n};\r\n\r\nLinting.prototype._createIssues = function(issues) {\r\n  for (var id in issues) {\r\n    this._createElementIssues(id, issues[id]);\r\n  }\r\n};\r\n\r\n/**\r\n * Create overlays for an elements issues.\r\n *\r\n * @param {string} elementId - Elements ID.\r\n * @param {Array} elementIssues - All element issues including warnings and errors.\r\n */\r\nLinting.prototype._createElementIssues = function(elementId, elementIssues) {\r\n  var element = this._elementRegistry.get(elementId);\r\n\r\n  if (!element) {\r\n    return;\r\n  }\r\n\r\n  var menuPosition;\r\n  var position;\r\n\r\n  if (element === this._canvas.getRootElement()) {\r\n    menuPosition = 'bottom-right';\r\n\r\n    position = {\r\n      top: 20,\r\n      left: 150\r\n    };\r\n  } else {\r\n    menuPosition = 'top-right';\r\n\r\n    position = {\r\n      top: OFFSET_TOP,\r\n      left: OFFSET_RIGHT\r\n    };\r\n  }\r\n\r\n  var issuesByType = groupBy(elementIssues, function(elementIssue) {\r\n    return elementIssue.category;\r\n  });\r\n\r\n  var errors = issuesByType.error,\r\n      warnings = issuesByType.warn;\r\n\r\n  if (!errors && !warnings) {\r\n    return;\r\n  }\r\n\r\n  var $html = domify(\r\n    '<div class=\"bjsl-overlay bjsl-issues-' + menuPosition + '\"></div>'\r\n  );\r\n\r\n  var $icon = errors\r\n    ? domify('<div class=\"bjsl-icon bjsl-icon-error\">' + ErrorSvg + '</div>')\r\n    : domify('<div class=\"bjsl-icon bjsl-icon-warning\">' + WarningSvg + '</div>');\r\n\r\n  var $dropdown = domify('<div class=\"bjsl-dropdown\"></div>');\r\n  var $dropdownContent = domify('<div class=\"bjsl-dropdown-content\"></div>');\r\n  var $issues = domify('<div class=\"bjsl-issues\"></div>');\r\n  var $issueList = domify('<ul></ul>');\r\n\r\n  $html.appendChild($icon);\r\n  $html.appendChild($dropdown);\r\n\r\n  $dropdown.appendChild($dropdownContent);\r\n  $dropdownContent.appendChild($issues);\r\n\r\n  $issues.appendChild($issueList);\r\n\r\n  if (errors) {\r\n    this._addErrors($issueList, errors);\r\n  }\r\n\r\n  if (warnings) {\r\n    this._addWarnings($issueList, warnings);\r\n  }\r\n\r\n  this._overlayIds[elementId] = this._overlays.add(element, 'linting', {\r\n    position: position,\r\n    html: $html,\r\n    scale: {\r\n      min: .9\r\n    }\r\n  });\r\n};\r\n\r\nLinting.prototype._addErrors = function($ul, errors) {\r\n\r\n  var self = this;\r\n\r\n  errors.forEach(function(error) {\r\n    self._addEntry($ul, 'error', error);\r\n  });\r\n};\r\n\r\nLinting.prototype._addWarnings = function($ul, warnings) {\r\n\r\n  var self = this;\r\n\r\n  warnings.forEach(function(error) {\r\n    self._addEntry($ul, 'warning', error);\r\n  });\r\n};\r\n\r\nLinting.prototype._addEntry = function($ul, state, entry) {\r\n\r\n  var rule = entry.rule,\r\n      message = this._translate(entry.message);\r\n\r\n  var icon = stateToIcon[state];\r\n\r\n  var $entry = domify(\r\n    '<li class=\"' + state + '\">' +\r\n      icon +\r\n      '<a title=\"' + escapeHTML(rule) + ': ' + escapeHTML(message) + '\" ' +\r\n         'data-rule=\"' + escapeHTML(rule) + '\" ' +\r\n         'data-message=\"' + escapeHTML(message) + '\"' +\r\n      '>' +\r\n        escapeHTML(message) +\r\n      '</a>' +\r\n    '</li>'\r\n  );\r\n\r\n  $ul.appendChild($entry);\r\n};\r\n\r\nLinting.prototype._clearOverlays = function() {\r\n  this._overlays.remove({ type: 'linting' });\r\n\r\n  this._overlayIds = {};\r\n};\r\n\r\nLinting.prototype._clearIssues = function() {\r\n  this._issues = {};\r\n\r\n  this._clearOverlays();\r\n};\r\n\r\nLinting.prototype._setButtonState = function(state, errors, warnings) {\r\n  var button = this._button;\r\n\r\n  var icon = stateToIcon[state];\r\n\r\n  var html = icon + '<span>' + this._translate('{errors} Errors, {warnings} Warnings', { errors: errors.toString(), warnings: warnings.toString() }) + '</span>';\r\n\r\n  [\r\n    'error',\r\n    'inactive',\r\n    'success',\r\n    'warning'\r\n  ].forEach(function(s) {\r\n    if (state === s) {\r\n      button.classList.add('bjsl-button-' + s);\r\n    } else {\r\n      button.classList.remove('bjsl-button-' + s);\r\n    }\r\n  });\r\n\r\n  button.innerHTML = html;\r\n};\r\n\r\nLinting.prototype._updateButton = function() {\r\n\r\n  if (!this.isActive()) {\r\n    this._setButtonState('inactive', 0, 0);\r\n\r\n    return;\r\n  }\r\n\r\n  var errors = 0,\r\n      warnings = 0;\r\n\r\n  for (var id in this._issues) {\r\n    this._issues[id].forEach(function(issue) {\r\n      if (issue.category === 'error') {\r\n        errors++;\r\n      } else if (issue.category === 'warn') {\r\n        warnings++;\r\n      }\r\n    });\r\n  }\r\n\r\n  var state = (errors && 'error') || (warnings && 'warning') || 'success';\r\n\r\n  this._setButtonState(state, errors, warnings);\r\n};\r\n\r\nLinting.prototype._createButton = function() {\r\n\r\n  var self = this;\r\n\r\n  this._button = domify(\r\n    '<button class=\"bjsl-button bjsl-button-inactive\" title=\"' + this._translate('Toggle linting') + '\"></button>'\r\n  );\r\n\r\n  this._button.addEventListener('click', function() {\r\n    self.toggle();\r\n  });\r\n\r\n  this._canvas.getContainer().appendChild(this._button);\r\n};\r\n\r\nLinting.prototype.lint = function() {\r\n  var definitions = this._bpmnjs.getDefinitions();\r\n\r\n  var linter = new Linter(this._linterConfig);\r\n\r\n  return linter.lint(definitions);\r\n};\r\n\r\nLinting.$inject = [\r\n  'bpmnjs',\r\n  'canvas',\r\n  'config.linting',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'overlays',\r\n  'translate'\r\n];\r\n","import EditorActions from './EditorActions';\r\nimport Linting from './Linting';\r\n\r\nexport default {\r\n  __init__: [ 'linting', 'lintingEditorActions' ],\r\n  linting: [ 'type', Linting ],\r\n  lintingEditorActions: ['type', EditorActions ]\r\n};"],"names":["reduce","groupBy","assign","domify","escapeHTML","Linter"],"mappings":"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"}