{"remainingRequest":"E:\\visual_code_work_space\\ruoyi-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\visual_code_work_space\\ruoyi-ui\\src\\components\\Process\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\visual_code_work_space\\ruoyi-ui\\src\\components\\Process\\index.vue","mtime":1693557459620},{"path":"E:\\visual_code_work_space\\ruoyi-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\visual_code_work_space\\ruoyi-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\visual_code_work_space\\ruoyi-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\visual_code_work_space\\ruoyi-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQovLyDmsYnljJYNCmltcG9ydCBjdXN0b21UcmFuc2xhdGUgZnJvbSAnLi9jb21tb24vY3VzdG9tVHJhbnNsYXRlJw0KaW1wb3J0IGxpbnRNb2R1bGUgZnJvbSAnYnBtbi1qcy1icG1ubGludCc7DQppbXBvcnQgTW9kZWxlciBmcm9tICdicG1uLWpzL2xpYi9Nb2RlbGVyJw0KLy8gaW1wb3J0IGJwbW5saW50Q29uZmlnIGZyb20gJy4vLmJwbW5saW50cmMnOw0KaW1wb3J0IHBhbmVsIGZyb20gJy4vUHJvcGVydHlQYW5lbCcNCmltcG9ydCBnZXRJbml0U3RyIGZyb20gJy4vZmxvd2FibGUvaW5pdCcNCi8vIOW8leWFpWZsb3dhYmxl55qE6IqC54K55paH5Lu2DQppbXBvcnQgRmxvd2FibGVNb2R1bGUgZnJvbSAnLi9mbG93YWJsZS9mbG93YWJsZS5qc29uJw0KaW1wb3J0IGN1c3RvbUNvbnRyb2xzTW9kdWxlIGZyb20gJy4vY3VzdG9tUGFuZWwnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ1dvcmtmbG93QnBtbk1vZGVsZXInLA0KICBjb21wb25lbnRzOiB7DQogICAgcGFuZWwNCiAgfSwNCiAgcHJvcHM6IHsNCiAgICB4bWw6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6ICcnDQogICAgfSwNCiAgICB1c2Vyczogew0KICAgICAgdHlwZTogQXJyYXksDQogICAgICBkZWZhdWx0OiAoKSA9PiBbXQ0KICAgIH0sDQogICAgZ3JvdXBzOiB7DQogICAgICB0eXBlOiBBcnJheSwNCiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdDQogICAgfSwNCiAgICBjYXRlZ29yeXM6IHsNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgICAgZGVmYXVsdDogKCkgPT4gW10NCiAgICB9LA0KICAgIGV4cHM6IHsNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgICAgZGVmYXVsdDogKCkgPT4gW10NCiAgICB9LA0KICAgIGlzVmlldzogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlDQogICAgfSwNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgbW9kZWxlcjogbnVsbCwNCiAgICAgIHpvb206IDENCiAgICB9DQogIH0sDQogIHdhdGNoOiB7DQogICAgeG1sOiBmdW5jdGlvbih2YWwpIHsNCiAgICAgIGlmICh2YWwpIHsNCiAgICAgICAgdGhpcy5jcmVhdGVOZXdEaWFncmFtKHZhbCkNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgLy8g55Sf5oiQ5a6e5L6LDQogICAgdGhpcy5tb2RlbGVyID0gbmV3IE1vZGVsZXIoew0KICAgICAgY29udGFpbmVyOiB0aGlzLiRyZWZzLmNhbnZhcywNCiAgICAgIGFkZGl0aW9uYWxNb2R1bGVzOiBbDQogICAgICAgIGxpbnRNb2R1bGUsDQogICAgICAgIGN1c3RvbUNvbnRyb2xzTW9kdWxlLA0KICAgICAgICB7IC8v5rGJ5YyWDQogICAgICAgICAgdHJhbnNsYXRlOiBbJ3ZhbHVlJywgY3VzdG9tVHJhbnNsYXRlXQ0KICAgICAgICB9LA0KICAgICAgXSwNCiAgICAgIC8vIOWOu+mZpOa1geeoi+agoemqjOWZqCzmnInpnIDmsYLlj6/oh6rooYzmt7vliqAs6ZyA6KaB5ZyocGFja2FnZS5qc29uIOWKoOWFpSAiYnBtbmxpbnQtcGx1Z2luLWxvY2FsIjogImZpbGU6YnBtbmxpbnQtcGx1Z2luLWxvY2FsIg0KICAgICAgLy8gbGludGluZzogew0KICAgICAgLy8gICBicG1ubGludDogYnBtbmxpbnRDb25maWcNCiAgICAgIC8vIH0sDQogICAgICBtb2RkbGVFeHRlbnNpb25zOiB7DQogICAgICAgIGZsb3dhYmxlOiBGbG93YWJsZU1vZHVsZQ0KICAgICAgfQ0KICAgIH0pDQogICAgLy8g5paw5aKe5rWB56iL5a6a5LmJDQogICAgaWYgKCF0aGlzLnhtbCkgew0KICAgICAgdGhpcy5uZXdEaWFncmFtKCkNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5jcmVhdGVOZXdEaWFncmFtKHRoaXMueG1sKQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIG5ld0RpYWdyYW0oKSB7DQogICAgICB0aGlzLmNyZWF0ZU5ld0RpYWdyYW0oZ2V0SW5pdFN0cigpKQ0KICAgIH0sDQogICAgLy8g6K6p5Zu+6IO96Ieq6YCC5bqU5bGP5bmVDQogICAgZml0Vmlld3BvcnQoKSB7DQogICAgICB0aGlzLnpvb20gPSB0aGlzLm1vZGVsZXIuZ2V0KCdjYW52YXMnKS56b29tKCdmaXQtdmlld3BvcnQnKQ0KICAgICAgY29uc3QgYmJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mbG93LWNvbnRhaW5lcnMgLnZpZXdwb3J0JykuZ2V0QkJveCgpDQogICAgICBjb25zdCBjdXJyZW50Vmlld2JveCA9IHRoaXMubW9kZWxlci5nZXQoJ2NhbnZhcycpLnZpZXdib3goKQ0KICAgICAgY29uc3QgZWxlbWVudE1pZCA9IHsNCiAgICAgICAgeDogYmJveC54ICsgYmJveC53aWR0aCAvIDIgLSA2NSwNCiAgICAgICAgeTogYmJveC55ICsgYmJveC5oZWlnaHQgLyAyDQogICAgICB9DQogICAgICB0aGlzLm1vZGVsZXIuZ2V0KCdjYW52YXMnKS52aWV3Ym94KHsNCiAgICAgICAgeDogZWxlbWVudE1pZC54IC0gY3VycmVudFZpZXdib3gud2lkdGggLyAyLA0KICAgICAgICB5OiBlbGVtZW50TWlkLnkgLSBjdXJyZW50Vmlld2JveC5oZWlnaHQgLyAyLA0KICAgICAgICB3aWR0aDogY3VycmVudFZpZXdib3gud2lkdGgsDQogICAgICAgIGhlaWdodDogY3VycmVudFZpZXdib3guaGVpZ2h0DQogICAgICB9KQ0KICAgICAgdGhpcy56b29tID0gYmJveC53aWR0aCAvIGN1cnJlbnRWaWV3Ym94LndpZHRoICogMS44DQogICAgfSwNCiAgICAvLyDmlL7lpKfnvKnlsI8NCiAgICB6b29tVmlld3BvcnQoem9vbUluID0gdHJ1ZSkgew0KICAgICAgdGhpcy56b29tID0gdGhpcy5tb2RlbGVyLmdldCgnY2FudmFzJykuem9vbSgpDQogICAgICB0aGlzLnpvb20gKz0gKHpvb21JbiA/IDAuMSA6IC0wLjEpDQogICAgICB0aGlzLm1vZGVsZXIuZ2V0KCdjYW52YXMnKS56b29tKHRoaXMuem9vbSkNCiAgICB9LA0KICAgIGFzeW5jIGNyZWF0ZU5ld0RpYWdyYW0oZGF0YSkgew0KICAgICAgLy8g5bCG5a2X56ym5Liy6L2s5o2i5oiQ5Zu+5pi+56S65Ye65p2lDQogICAgICAvLyBkYXRhID0gZGF0YS5yZXBsYWNlKC88IVxbQ0RBVEFcWyguKz8pXV0+L2csICcmbHQ7IVtDREFUQVskMV1dJmd0OycpDQogICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC88IVxbQ0RBVEFcWyguKz8pXV0+L2csIGZ1bmN0aW9uKG1hdGNoLCBzdHIpIHsNCiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC88L2csICcmbHQ7JykNCiAgICAgIH0pDQogICAgICB0cnkgew0KICAgICAgICBhd2FpdCB0aGlzLm1vZGVsZXIuaW1wb3J0WE1MKGRhdGEpDQogICAgICAgIC8vIHRoaXMuYWRqdXN0UGFsZXR0ZSgpDQogICAgICAgIHRoaXMuZml0Vmlld3BvcnQoKQ0KICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UsIGVyci53YXJuaW5ncykNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWvueWkliBhcGkNCiAgICBnZXRQcm9jZXNzKCkgew0KICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuZ2V0UHJvY2Vzc0VsZW1lbnQoKQ0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgaWQ6IGVsZW1lbnQuaWQsDQogICAgICAgIG5hbWU6IGVsZW1lbnQubmFtZSwNCiAgICAgICAgY2F0ZWdvcnk6IGVsZW1lbnQuJGF0dHJzWydmbG93YWJsZTpwcm9jZXNzQ2F0ZWdvcnknXQ0KICAgICAgfQ0KICAgIH0sDQogICAgZ2V0UHJvY2Vzc0VsZW1lbnQoKSB7DQogICAgICBjb25zdCByb290RWxlbWVudHMgPSB0aGlzLm1vZGVsZXIuZ2V0RGVmaW5pdGlvbnMoKS5yb290RWxlbWVudHMNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm9vdEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChyb290RWxlbWVudHNbaV0uJHR5cGUgPT09ICdicG1uOlByb2Nlc3MnKSByZXR1cm4gcm9vdEVsZW1lbnRzW2ldDQogICAgICB9DQogICAgfSwNCiAgICBhc3luYyB2ZXJpZnlYTUwoKXsNCiAgICAgIGNvbnN0IGxpbnRpbmcgPSB0aGlzLm1vZGVsZXIuZ2V0KCdsaW50aW5nJykNCiAgICAgIGxpbnRpbmcudG9nZ2xlKCk7DQogICAgfSwNCiAgICBhc3luYyBzYXZlWE1MKGRvd25sb2FkID0gZmFsc2UpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHsgeG1sIH0gPSBhd2FpdCB0aGlzLm1vZGVsZXIuc2F2ZVhNTCh7IGZvcm1hdDogdHJ1ZSB9KQ0KICAgICAgICBpZiAoZG93bmxvYWQpIHsNCiAgICAgICAgICB0aGlzLmRvd25sb2FkRmlsZShgJHt0aGlzLmdldFByb2Nlc3NFbGVtZW50KCkubmFtZX0uYnBtbjIwLnhtbGAsIHhtbCwgJ2FwcGxpY2F0aW9uL3htbCcpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHhtbA0KICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUubG9nKGVycikNCiAgICAgIH0NCiAgICB9LA0KICAgIGFzeW5jIHNob3dYTUwoKSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCB4bWwgPSBhd2FpdCB0aGlzLnNhdmVYTUwoKQ0KICAgICAgICB0aGlzLiRlbWl0KCdzaG93WE1MJyx4bWwpDQogICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5sb2coZXJyKQ0KICAgICAgfQ0KICAgIH0sDQogICAgYXN5bmMgc2F2ZUltZyh0eXBlID0gJ3N2ZycsIGRvd25sb2FkID0gZmFsc2UpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHsgc3ZnIH0gPSBhd2FpdCB0aGlzLm1vZGVsZXIuc2F2ZVNWRyh7IGZvcm1hdDogdHJ1ZSB9KQ0KICAgICAgICBpZiAoZG93bmxvYWQpIHsNCiAgICAgICAgICB0aGlzLmRvd25sb2FkRmlsZSh0aGlzLmdldFByb2Nlc3NFbGVtZW50KCkubmFtZSwgc3ZnLCAnaW1hZ2Uvc3ZnK3htbCcpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN2Zw0KICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnNvbGUubG9nKGVycikNCiAgICAgIH0NCiAgICB9LA0KICAgIGFzeW5jIHNhdmUoKSB7DQogICAgICBjb25zdCBwcm9jZXNzID0gdGhpcy5nZXRQcm9jZXNzKCkNCiAgICAgIGNvbnN0IHhtbCA9IGF3YWl0IHRoaXMuc2F2ZVhNTCgpDQogICAgICBjb25zdCBzdmcgPSBhd2FpdCB0aGlzLnNhdmVJbWcoKQ0KICAgICAgY29uc3QgcmVzdWx0ID0geyBwcm9jZXNzLCB4bWwsIHN2ZyB9DQogICAgICB0aGlzLiRlbWl0KCdzYXZlJywgcmVzdWx0KQ0KICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShyZXN1bHQsICcqJykNCiAgICB9LA0KICAgIG9wZW5CcG1uKGZpbGUpIHsNCiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCkNCiAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUsICd1dGYtOCcpDQogICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gew0KICAgICAgICB0aGlzLmNyZWF0ZU5ld0RpYWdyYW0ocmVhZGVyLnJlc3VsdCkNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0sDQogICAgZG93bmxvYWRGaWxlKGZpbGVuYW1lLCBkYXRhLCB0eXBlKSB7DQogICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOw0KICAgICAgY29uc3QgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2RhdGFdLCB7dHlwZTogdHlwZX0pKTsNCiAgICAgIGEuaHJlZiA9IHVybA0KICAgICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lDQogICAgICBhLmNsaWNrKCkNCiAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCkNCiAgICB9LA0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/Process","sourcesContent":["<template>\r\n  <div v-loading=\"isView\" class=\"flow-containers\" :class=\"{ 'view-mode': isView }\">\r\n    <el-container style=\"height: 100%\">\r\n      <el-header style=\"border-bottom: 1px solid rgb(218 218 218);height: auto;padding-left:0px\">\r\n        <div style=\"display: flex; padding: 10px 0px; justify-content: space-between;\">\r\n          <div>\r\n            <el-upload action=\"\" :before-upload=\"openBpmn\" style=\"margin-right: 10px; display:inline-block;\">\r\n              <el-tooltip effect=\"dark\" content=\"加载xml\" placement=\"bottom\">\r\n                <el-button size=\"mini\" icon=\"el-icon-folder-opened\" />\r\n              </el-tooltip>\r\n            </el-upload>\r\n            <el-tooltip effect=\"dark\" content=\"新建\" placement=\"bottom\">\r\n              <el-button size=\"mini\" icon=\"el-icon-circle-plus\" @click=\"newDiagram\" />\r\n            </el-tooltip>\r\n            <el-tooltip effect=\"dark\" content=\"自适应屏幕\" placement=\"bottom\">\r\n              <el-button size=\"mini\" icon=\"el-icon-rank\" @click=\"fitViewport\" />\r\n            </el-tooltip>\r\n            <el-tooltip effect=\"dark\" content=\"放大\" placement=\"bottom\">\r\n              <el-button size=\"mini\" icon=\"el-icon-zoom-in\" @click=\"zoomViewport(true)\" />\r\n            </el-tooltip>\r\n            <el-tooltip effect=\"dark\" content=\"缩小\" placement=\"bottom\">\r\n              <el-button size=\"mini\" icon=\"el-icon-zoom-out\" @click=\"zoomViewport(false)\" />\r\n            </el-tooltip>\r\n            <el-tooltip effect=\"dark\" content=\"后退\" placement=\"bottom\">\r\n              <el-button size=\"mini\" icon=\"el-icon-back\" @click=\"modeler.get('commandStack').undo()\" />\r\n            </el-tooltip>\r\n            <el-tooltip effect=\"dark\" content=\"前进\" placement=\"bottom\">\r\n              <el-button size=\"mini\" icon=\"el-icon-right\" @click=\"modeler.get('commandStack').redo()\" />\r\n            </el-tooltip>\r\n          </div>\r\n          <div>\r\n<!--            <el-button size=\"mini\" icon=\"el-icon-s-check\" @click=\"verifyXML\">校验xml</el-button>-->\r\n            <el-button size=\"mini\" icon=\"el-icon-view\" @click=\"showXML\">查看xml</el-button>\r\n            <el-button size=\"mini\" icon=\"el-icon-download\" @click=\"saveXML(true)\">下载xml</el-button>\r\n            <el-button size=\"mini\" icon=\"el-icon-picture\" @click=\"saveImg('svg', true)\">下载svg</el-button>\r\n            <el-button size=\"mini\" type=\"primary\" @click=\"save\">保存模型</el-button>\r\n          </div>\r\n        </div>\r\n      </el-header>\r\n      <el-container style=\"align-items: stretch\">\r\n        <el-main style=\"padding: 0;\">\r\n          <div ref=\"canvas\" class=\"canvas\" />\r\n        </el-main>\r\n        <el-aside style=\"width: 400px; min-height: 650px; background-color: #f0f2f5\">\r\n          <panel v-if=\"modeler\" :modeler=\"modeler\" :users=\"users\" :groups=\"groups\" :exps=\"exps\" :categorys=\"categorys\" />\r\n        </el-aside>\r\n      </el-container>\r\n    </el-container>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 汉化\r\nimport customTranslate from './common/customTranslate'\r\nimport lintModule from 'bpmn-js-bpmnlint';\r\nimport Modeler from 'bpmn-js/lib/Modeler'\r\n// import bpmnlintConfig from './.bpmnlintrc';\r\nimport panel from './PropertyPanel'\r\nimport getInitStr from './flowable/init'\r\n// 引入flowable的节点文件\r\nimport FlowableModule from './flowable/flowable.json'\r\nimport customControlsModule from './customPanel'\r\n\r\nexport default {\r\n  name: 'WorkflowBpmnModeler',\r\n  components: {\r\n    panel\r\n  },\r\n  props: {\r\n    xml: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    users: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    groups: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    categorys: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    exps: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    isView: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      modeler: null,\r\n      zoom: 1\r\n    }\r\n  },\r\n  watch: {\r\n    xml: function(val) {\r\n      if (val) {\r\n        this.createNewDiagram(val)\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    // 生成实例\r\n    this.modeler = new Modeler({\r\n      container: this.$refs.canvas,\r\n      additionalModules: [\r\n        lintModule,\r\n        customControlsModule,\r\n        { //汉化\r\n          translate: ['value', customTranslate]\r\n        },\r\n      ],\r\n      // 去除流程校验器,有需求可自行添加,需要在package.json 加入 \"bpmnlint-plugin-local\": \"file:bpmnlint-plugin-local\"\r\n      // linting: {\r\n      //   bpmnlint: bpmnlintConfig\r\n      // },\r\n      moddleExtensions: {\r\n        flowable: FlowableModule\r\n      }\r\n    })\r\n    // 新增流程定义\r\n    if (!this.xml) {\r\n      this.newDiagram()\r\n    } else {\r\n      this.createNewDiagram(this.xml)\r\n    }\r\n  },\r\n  methods: {\r\n    newDiagram() {\r\n      this.createNewDiagram(getInitStr())\r\n    },\r\n    // 让图能自适应屏幕\r\n    fitViewport() {\r\n      this.zoom = this.modeler.get('canvas').zoom('fit-viewport')\r\n      const bbox = document.querySelector('.flow-containers .viewport').getBBox()\r\n      const currentViewbox = this.modeler.get('canvas').viewbox()\r\n      const elementMid = {\r\n        x: bbox.x + bbox.width / 2 - 65,\r\n        y: bbox.y + bbox.height / 2\r\n      }\r\n      this.modeler.get('canvas').viewbox({\r\n        x: elementMid.x - currentViewbox.width / 2,\r\n        y: elementMid.y - currentViewbox.height / 2,\r\n        width: currentViewbox.width,\r\n        height: currentViewbox.height\r\n      })\r\n      this.zoom = bbox.width / currentViewbox.width * 1.8\r\n    },\r\n    // 放大缩小\r\n    zoomViewport(zoomIn = true) {\r\n      this.zoom = this.modeler.get('canvas').zoom()\r\n      this.zoom += (zoomIn ? 0.1 : -0.1)\r\n      this.modeler.get('canvas').zoom(this.zoom)\r\n    },\r\n    async createNewDiagram(data) {\r\n      // 将字符串转换成图显示出来\r\n      // data = data.replace(/<!\\[CDATA\\[(.+?)]]>/g, '&lt;![CDATA[$1]]&gt;')\r\n      data = data.replace(/<!\\[CDATA\\[(.+?)]]>/g, function(match, str) {\r\n        return str.replace(/</g, '&lt;')\r\n      })\r\n      try {\r\n        await this.modeler.importXML(data)\r\n        // this.adjustPalette()\r\n        this.fitViewport()\r\n      } catch (err) {\r\n        console.error(err.message, err.warnings)\r\n      }\r\n    },\r\n    // 对外 api\r\n    getProcess() {\r\n      const element = this.getProcessElement()\r\n      return {\r\n        id: element.id,\r\n        name: element.name,\r\n        category: element.$attrs['flowable:processCategory']\r\n      }\r\n    },\r\n    getProcessElement() {\r\n      const rootElements = this.modeler.getDefinitions().rootElements\r\n      for (let i = 0; i < rootElements.length; i++) {\r\n        if (rootElements[i].$type === 'bpmn:Process') return rootElements[i]\r\n      }\r\n    },\r\n    async verifyXML(){\r\n      const linting = this.modeler.get('linting')\r\n      linting.toggle();\r\n    },\r\n    async saveXML(download = false) {\r\n      try {\r\n        const { xml } = await this.modeler.saveXML({ format: true })\r\n        if (download) {\r\n          this.downloadFile(`${this.getProcessElement().name}.bpmn20.xml`, xml, 'application/xml')\r\n        }\r\n        return xml\r\n      } catch (err) {\r\n        console.log(err)\r\n      }\r\n    },\r\n    async showXML() {\r\n      try {\r\n        const xml = await this.saveXML()\r\n        this.$emit('showXML',xml)\r\n      } catch (err) {\r\n        console.log(err)\r\n      }\r\n    },\r\n    async saveImg(type = 'svg', download = false) {\r\n      try {\r\n        const { svg } = await this.modeler.saveSVG({ format: true })\r\n        if (download) {\r\n          this.downloadFile(this.getProcessElement().name, svg, 'image/svg+xml')\r\n        }\r\n        return svg\r\n      } catch (err) {\r\n        console.log(err)\r\n      }\r\n    },\r\n    async save() {\r\n      const process = this.getProcess()\r\n      const xml = await this.saveXML()\r\n      const svg = await this.saveImg()\r\n      const result = { process, xml, svg }\r\n      this.$emit('save', result)\r\n      window.parent.postMessage(result, '*')\r\n    },\r\n    openBpmn(file) {\r\n      const reader = new FileReader()\r\n      reader.readAsText(file, 'utf-8')\r\n      reader.onload = () => {\r\n        this.createNewDiagram(reader.result)\r\n      }\r\n      return false\r\n    },\r\n    downloadFile(filename, data, type) {\r\n      const a = document.createElement('a');\r\n      const url = window.URL.createObjectURL(new Blob([data], {type: type}));\r\n      a.href = url\r\n      a.download = filename\r\n      a.click()\r\n      window.URL.revokeObjectURL(url)\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n/*左边工具栏以及编辑节点的样式*/\r\n@import \"~bpmn-js/dist/assets/diagram-js.css\";\r\n@import \"~bpmn-js/dist/assets/bpmn-font/css/bpmn.css\";\r\n@import \"~bpmn-js/dist/assets/bpmn-font/css/bpmn-codes.css\";\r\n@import \"~bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css\";\r\n//@import \"~bpmn-js-bpmnlint/dist/assets/css/bpmn-js-bpmnlint.css\";\r\n.view-mode {\r\n  .el-header, .el-aside, .djs-palette, .bjs-powered-by {\r\n    display: none;\r\n  }\r\n  .el-loading-mask {\r\n    background-color: initial;\r\n  }\r\n  .el-loading-spinner {\r\n    display: none;\r\n  }\r\n}\r\n.flow-containers {\r\n  // background-color: #ffffff;\r\n  width: 100%;\r\n  height: 100%;\r\n  .canvas {\r\n    width: 100%;\r\n    height: 100%;\r\n    //flex: 1;\r\n    //position: relative;\r\n    //background: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImEiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTTAgMTBoNDBNMTAgMHY0ME0wIDIwaDQwTTIwIDB2NDBNMCAzMGg0ME0zMCAwdjQwIiBmaWxsPSJub25lIiBzdHJva2U9IiNlMGUwZTAiIG9wYWNpdHk9Ii4yIi8+PHBhdGggZD0iTTQwIDBIMHY0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2EpIi8+PC9zdmc+\")\r\n    //repeat !important;\r\n    //div.toggle-mode {\r\n    //  display: none;\r\n    //}\r\n  }\r\n  .panel {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 50px;\r\n    width: 300px;\r\n  }\r\n  .load {\r\n    margin-right: 10px;\r\n  }\r\n  .el-form-item__label{\r\n    font-size: 13px;\r\n  }\r\n\r\n  .djs-palette{\r\n    left: 0px!important;\r\n    top: 0px;\r\n    border-top: none;\r\n  }\r\n\r\n  .djs-container svg {\r\n    //min-height: 650px;\r\n  }\r\n\r\n   .highlight.djs-shape .djs-visual > :nth-child(1) {\r\n     fill: green !important;\r\n     stroke: green !important;\r\n     fill-opacity: 0.2 !important;\r\n   }\r\n   .highlight.djs-shape .djs-visual > :nth-child(2) {\r\n     fill: green !important;\r\n   }\r\n   .highlight.djs-shape .djs-visual > path {\r\n     fill: green !important;\r\n     fill-opacity: 0.2 !important;\r\n     stroke: green !important;\r\n   }\r\n   .highlight.djs-connection > .djs-visual > path {\r\n     stroke: green !important;\r\n   }\r\n   // .djs-connection > .djs-visual > path {\r\n   //   stroke: orange !important;\r\n   //   stroke-dasharray: 4px !important;\r\n   //   fill-opacity: 0.2 !important;\r\n   // }\r\n   // .djs-shape .djs-visual > :nth-child(1) {\r\n   //   fill: orange !important;\r\n   //   stroke: orange !important;\r\n   //   stroke-dasharray: 4px !important;\r\n   //   fill-opacity: 0.2 !important;\r\n   // }\r\n   .highlight-todo.djs-connection > .djs-visual > path {\r\n     stroke: orange !important;\r\n     stroke-dasharray: 4px !important;\r\n     fill-opacity: 0.2 !important;\r\n   }\r\n   .highlight-todo.djs-shape .djs-visual > :nth-child(1) {\r\n     fill: orange !important;\r\n     stroke: orange !important;\r\n     stroke-dasharray: 4px !important;\r\n     fill-opacity: 0.2 !important;\r\n   }\r\n   .overlays-div {\r\n     font-size: 10px;\r\n     color: red;\r\n     width: 100px;\r\n     top: -20px !important;\r\n   }\r\n}\r\n</style>\r\n"]}]}